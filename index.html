<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Alphabet Catcher</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-color: #87CEEB;
            --text-color: #ffffff;
            --accent-color: #ffca28;
            --font-family: 'Fredoka One', cursive;
            --correct-color: #66bb6a;
            --wrong-color: #ef5350;
        }
        * { box-sizing: border-box; }
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; font-family: var(--font-family);
            background-color: var(--bg-color);
            user-select: none; -webkit-user-select: none;
            touch-action: none;
        }
        #game-container {
            width: 100%; height: 100%; position: relative;
            background-image: linear-gradient(to bottom, var(--bg-color), #a3d9f0);
            display: flex; align-items: center; justify-content: center;
            transition: background-color 0.2s;
        }
        #game-area {
            width: 100%; max-width: 600px; height: 100%;
            position: relative; overflow: hidden;
            cursor: grab;
        }
        #game-area:active { cursor: grabbing; }
        #info-bar {
            position: absolute; top: 10px; left: 0; width: 100%;
            display: flex; flex-direction: column; align-items: center;
            color: var(--text-color); text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            padding: 10px; font-size: clamp(1rem, 4vw, 1.5rem);
        }
        #target-word-container {
            font-size: clamp(2rem, 8vw, 3.5rem); background-color: rgba(0,0,0,0.2);
            padding: 5px 25px; border-radius: 20px;
            margin-bottom: 10px;
        }
        .target-letter {
            display: inline-block;
            transition: color 0.3s;
        }
        .target-letter.caught {
            color: var(--correct-color);
            transform: scale(1.1);
        }
        #stats-bar { display: flex; width: 100%; justify-content: space-around; }
        #player-basket {
            width: 80px; height: 60px; font-size: 50px;
            text-align: center; position: absolute; bottom: 20px;
            left: 50%; transform: translateX(-50%);
            pointer-events: none;
        }
        .falling-letter {
            position: absolute; width: 60px; height: 60px;
            background-color: var(--accent-color); color: #5c4a3d; font-size: 40px;
            display: flex; align-items: center; justify-content: center;
            border-radius: 50%; box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            pointer-events: none;
        }
        .screen-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5); display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            color: white; text-align: center; z-index: 10;
        }
        .screen-overlay h1 { font-size: 50px; }
        .screen-overlay p { font-size: 24px; }
        .screen-button {
            padding: 15px 40px; font-size: 28px; font-family: var(--font-family);
            border-radius: 20px; border: none; background-color: var(--accent-color);
            color: #5c4a3d; cursor: pointer; box-shadow: 0 6px 0 #c79a1a;
            transition: all 0.1s;
        }
        .screen-button:active { transform: translateY(4px); box-shadow: 0 2px 0 #c79a1a; }
        #game-over-screen { display: none; }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="game-area">
            <div id="info-bar">
                <div id="target-word-container"></div>
                <div id="stats-bar">
                    <span id="score-display">Score: 0</span>
                    <span id="tries-display">Wrong: 0</span>
                </div>
            </div>
            <div id="player-basket">ðŸ§º</div>
        </div>

        <div class="screen-overlay" id="start-screen">
            <h1>Word Catcher</h1>
            <p>Catch the letters to complete the word!</p>
            <button class="screen-button" id="start-btn">Play</button>
        </div>
        <div class="screen-overlay" id="game-over-screen">
            <h1>Game Over!</h1>
            <p id="final-score">Words Completed: 0</p>
            <p id="high-score">High Score: 0</p>
            <button class="screen-button" id="play-again-btn">Play Again</button>
        </div>
    </div>
    
    <!-- FIX: Updated audio paths to remove the '/sounds' subdirectory -->
    <audio id="success-sound" src="assets/success.mp3"></audio>
    <audio id="fail-sound" src="assets/fail.mp3"></audio>
    <audio id="word-complete-sound" src="assets/word-complete.mp3"></audio>
    <audio id="bg-music" src="assets/bg-music.mp3" loop></audio>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            const gameArea = document.getElementById('game-area');
            const playerBasket = document.getElementById('player-basket');
            const scoreDisplay = document.getElementById('score-display');
            const triesDisplay = document.getElementById('tries-display');
            const targetWordContainer = document.getElementById('target-word-container');
            const startScreen = document.getElementById('start-screen');
            const gameOverScreen = document.getElementById('game-over-screen');
            const startBtn = document.getElementById('start-btn');
            const playAgainBtn = document.getElementById('play-again-btn');
            const finalScoreDisplay = document.getElementById('final-score');
            const highScoreDisplay = document.getElementById('high-score');
            
            // Audio elements
            const successSound = document.getElementById('success-sound');
            const failSound = document.getElementById('fail-sound');
            const wordCompleteSound = document.getElementById('word-complete-sound');
            const bgMusic = document.getElementById('bg-music');

            const WORD_LIST = ['APPLE', 'BALL', 'CAT', 'DOG', 'STAR', 'FROG', 'DUCK', 'TREE'];
            const ALPHABET = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            let score, wrongTries, targetWord, currentLetterIndex;
            let fallingLetters, gameLoopInterval, spawnInterval;
            let fallingSpeed;
            let highScore = localStorage.getItem('wordCatcherHighScore') || 0;
            
            let isDragging = false;
            
            // Helper to play sounds safely
            function playSound(soundElement) {
                soundElement.currentTime = 0;
                soundElement.play().catch(e => console.error("Sound play failed:", e));
            }

            function startGame() {
                score = 0; wrongTries = 0; fallingSpeed = 3;
                if (fallingLetters) fallingLetters.forEach(letter => letter.element.remove());
                fallingLetters = [];

                updateScoreDisplay();
                
                startScreen.style.display = 'none';
                gameOverScreen.style.display = 'none';
                
                playSound(bgMusic);

                setNewTargetWord();
                gameLoopInterval = setInterval(gameLoop, 1000 / 60);
                spawnInterval = setInterval(spawnLetter, 1000);
            }

            function gameLoop() {
                fallingLetters.forEach((letter, index) => {
                    letter.y += fallingSpeed;
                    letter.element.style.top = letter.y + 'px';

                    if (isColliding(playerBasket, letter.element)) {
                        handleCatch(letter);
                        letter.element.remove();
                        fallingLetters.splice(index, 1);
                    } 
                    else if (letter.y > gameArea.clientHeight) {
                        letter.element.remove();
                        fallingLetters.splice(index, 1);
                    }
                });
            }

            function handleCatch(caughtLetter) {
                const requiredLetter = targetWord[currentLetterIndex];

                if (caughtLetter.char === requiredLetter) {
                    playSound(successSound); // FIX: Play sound on correct catch
                    const targetSpans = targetWordContainer.children;
                    targetSpans[currentLetterIndex].classList.add('caught');
                    currentLetterIndex++;
                    
                    if (currentLetterIndex >= targetWord.length) {
                        playSound(wordCompleteSound); // FIX: Play sound on word completion
                        score++;
                        updateScoreDisplay();
                        fallingSpeed += 0.5;
                        setTimeout(setNewTargetWord, 800);
                    }

                } else {
                    playSound(failSound); // FIX: Play sound on wrong catch
                    wrongTries++;
                    triesDisplay.textContent = `Wrong: ${wrongTries}`;
                    gameArea.style.backgroundColor = 'var(--wrong-color)';
                    setTimeout(() => gameArea.style.backgroundColor = '', 200);

                    if (wrongTries >= 5) {
                        endGame();
                    }
                }
            }

            function spawnLetter() {
                const requiredLetter = targetWord[currentLetterIndex];
                let char = (Math.random() < 0.4 && requiredLetter) ? requiredLetter : ALPHABET[Math.floor(Math.random() * ALPHABET.length)];
                
                const element = document.createElement('div');
                element.className = 'falling-letter';
                element.textContent = char;
                element.style.left = `${Math.random() * (gameArea.clientWidth - 60)}px`;
                element.style.top = '-60px';
                element.style.backgroundColor = `hsl(${Math.random() * 360}, 90%, 70%)`;

                gameArea.appendChild(element);
                fallingLetters.push({ element: element, char: char, y: -60 });
            }

            function endGame() {
                clearInterval(gameLoopInterval);
                clearInterval(spawnInterval);
                bgMusic.pause();

                if (score > highScore) {
                    highScore = score;
                    localStorage.setItem('wordCatcherHighScore', highScore);
                }
                finalScoreDisplay.textContent = `Words Completed: ${score}`;
                highScoreDisplay.textContent = `High Score: ${highScore}`;
                
                gameOverScreen.style.display = 'flex';
            }
            
            function setNewTargetWord() {
                targetWord = WORD_LIST[Math.floor(Math.random() * WORD_LIST.length)];
                currentLetterIndex = 0;
                
                targetWordContainer.innerHTML = targetWord.split('').map(letter => `<span class="target-letter">${letter}</span>`).join('');
            }

            function updateScoreDisplay() {
                scoreDisplay.textContent = `Score: ${score}`;
                triesDisplay.textContent = `Wrong: ${wrongTries}`;
            }

            function isColliding(el1, el2) {
                const rect1 = el1.getBoundingClientRect();
                const rect2 = el2.getBoundingClientRect();
                return !(rect1.right < rect2.left || rect1.left > rect2.right || rect1.bottom < rect2.top || rect1.top > rect2.bottom);
            }

            function movePlayer(clientX) {
                const gameAreaRect = gameArea.getBoundingClientRect();
                let newX = clientX - gameAreaRect.left;
                const minLeft = 0;
                const maxLeft = gameArea.clientWidth - playerBasket.clientWidth;
                let leftPos = newX - playerBasket.clientWidth / 2;
                leftPos = Math.max(minLeft, Math.min(leftPos, maxLeft));
                playerBasket.style.left = `${leftPos}px`;
            }
            
            window.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
                    const currentLeft = playerBasket.offsetLeft;
                    const offset = (e.key === 'ArrowLeft' ? -20 : 20);
                    movePlayer(currentLeft + playerBasket.clientWidth / 2 + offset);
                }
            });

            gameArea.addEventListener('pointerdown', (e) => { isDragging = true; movePlayer(e.clientX); });
            gameArea.addEventListener('pointermove', (e) => { if (isDragging) movePlayer(e.clientX); });
            window.addEventListener('pointerup', () => { isDragging = false; });

            startBtn.addEventListener('click', startGame);
            playAgainBtn.addEventListener('click', startGame);
        });
    </script>
</body>
    </html>
